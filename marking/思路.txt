标注系统发布了果然遇到了不少问题，
这次终于遇到了并发的问题，情况大概是这样的：
1.原本的程序在Submit.java中抽取评论，当标注内容完成，按下提交之后，会执行Insert.java，在Insert里面，程序会更新comment_carhome里面对应id下的一个叫做picked的字段，讲它的值加一
Submit程序中会先判断picked值是否大于3再抽取，但是当遇到多个线程一起访问的时候，submit和insert就会被分成两个阶段，当有人还在标注的时候（还没提交）picked的值不会加一，但是picked又小于3（还没到达3，或许只是2），另一个线程去抽取评论时就会讲picked判断成小于3 可以抽取
这样一来就导致了有的评论会被抽取三次以上，当picked大于3了才不会继续被抽取
这也可以很好的解释为什么那几条被抽取了9次的评论一动不动。


所以后来我把更新picked的语句写在submit中



2.但是这样一来又得考虑评论被抽取出来了，没有成功提交的情况，这种情况下，抽取出来的评论不会被插入markin2里面，但是picked会加一，也是一个必须处理的问题：

对于这个问题，我开始的想法是：把评论放入cookie，cookie和session的区别是，关掉浏览器后，cookie还会被保留在电脑上，但是session就会消失，每次在数据库抽取新数据之前，先看看cookie是否为空，如果是就重新抽取，并且让picked加一，否则直接加载cookie里面的内容不对数据库做任何操作


3.但是在尝试这种方法的时候，我就发现，系统会抛出一个“头部太大”的异常，原因是cookie不可以储存太多的数据，的确四十几条评论也是多了一点，那就不能用cookie了


后来，我在comment_carhome上面有增加了一个字段，叫做inuse，每次抽取的时候除了判断picked是否大于3 还判断该语句是否在用


4.但是这样也解决不了浏览器被关掉的问题，浏览器一旦被关掉就不会执行insert也即意味着inuse的值不能被改回来了，明明已经没有在用的评论id也不能被抽取


于是我在想：能不能把session和cookie结合起来，cookie不能保存所有评论（缓存装不下）但是可以保存评论id啊！第一次抽取评论时，在cookie上放评论id，在session上放所有评论，提交之后将对应picked加一，inuse清0，并就把cookie和session都清空，
每次抽取评论时，1、每次加载先判断session是否为空，不空就直接加载session的数据内容，session为空（可能是浏览器关掉所导致的） 就判断cookie是否为空，为空的话就执行数据库随机抽取，不为空的话（标注期间的中断导致的）就只抽cookie存下来的id的评论


